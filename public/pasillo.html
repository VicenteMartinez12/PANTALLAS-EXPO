<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasillo Turnero</title>
    <style>
        .tabla {
            border-collapse: collapse;
            width: 100%;
            margin-top: 2%;
        }
       
     
        .tabla td {
           
      
            border: 1px solid black;
            font-size: 80px;
            font-weight: bold;
            align-items: center;
            text-align: center;
           
           
            
        }
        .tabla th{
            padding: 8px;
            border: 1px solid black;
            font-size: 80px;
            font-weight: bold;
        }
        .tabla tr {
            height: 100px;
        
        }
        .tabla img {
            max-width: 300px;
      
            max-height: 100px;
  
        }
        .tabla td:last-child {
            text-align: left;
          
            font-size: 130px;
            margin-right: 10%;
          
        }
        .numeros {
      display: flex;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 50px;
  
            width: 98.8%;
            
            
            
          
            
        }
        @keyframes blink {
            0% {
                background-color: yellow;
            }
            50% {
                background-color: transparent;
            }
            100% {
                background-color: yellow;
            }
        }
        .parpadeo {
            animation: blink 1s infinite;
        }
     
        .image-container {
            text-align: right;
        }
        .imagen-td {
            width: 100%;
            height: 100%;
            display: block;
            margin: 0;
            padding: 0;
            object-fit: cover;
         
        }
        
    
   
        
    </style>
</head>
<body>

    <div id="pasillo1" style="display:block;">
        <div style="display: flex; align-items: center;">
            <div style="max-width: 100%; width: 100%; height: 100%;">
                <div style="height: 100%; display: flex; flex-direction: column;">
                    <div style=" justify-content: center; align-items: center; height: 100%; margin-top: 0%;">
                        <table style="width: 100%; height: 88%; font-size: 50px;" class="tabla">
                            <thead>
                                <tr>
                                    <th style="font-size: 100px; background-color: #012475; color: antiquewhite; text-align: center; "><img src="./img/expoTony.png" alt=""></th>
                                    <th style="font-size: 100px;  background-color: #012475; color: antiquewhite;    text-align: center; ">Próximos turnos   <img style="float: right;" src="./img/expoTony.png" alt=""></th>
                                </tr>
                            </thead>
                            <tbody id="tablaBody">
                                <tr id="fila-1">
                                    <td  style="background-color: rgb(198, 232, 251);"></td>
                                    <td  class= "numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                        
                                    </td>
                                </tr>
                                <tr id="fila-2">
                                    <td></td>
                                    <td style="align-content: center;" class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                       
                                        
                                    </td>
                                </tr>
                                <tr id="fila-3">
                                    <td  style="background-color: rgb(198, 232, 251);"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-4">
                                    <td></td>
                                    <td class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-5">
                                    <td  style="background-color: rgb(198, 232, 251);"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="pasillo2" class="oculto">
        <div style="display: flex; align-items: center;">
            <div style="max-width: 100%; width: 100%; height: 100%;">
                <div style="height: 100%; display: flex; flex-direction: column;">
                    <div style=" justify-content: center; align-items: center; height: 100%; margin-top: 0%;">
                        <table style="width: 100%; height: 88%; font-size: 50px;" class="tabla">
                            <thead>
                                <tr>
                                    <th style="font-size: 100px; background-color: #012475; color: antiquewhite; text-align: center; "><img src="./img/expoTony.png" alt=""></th>
                                    <th style="font-size: 100px;  background-color: #012475; color: antiquewhite;    text-align: center; ">Próximos turnos   <img style="float: right;" src="./img/expoTony.png" alt=""></th>
                                </tr>
                            </thead>
                            <tbody id="tablaBody">
                                <tr id="fila-6">
                                    <td  style="background-color: rgb(198, 232, 251);"></td>
                                    <td  class= "numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                        
                                    </td>
                                </tr>
                                <tr id="fila-7">
                                    <td></td>
                                    <td style="align-content: center;" class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                       
                                        
                                    </td>
                                </tr>
                                <tr id="fila-8">
                                    <td  style="background-color: rgb(198, 232, 251);"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-9">
                                    <td></td>
                                    <td class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-10">
                                    <td  style="background-color: rgb(198, 232, 251);"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>


    
    <script src="./socket.io/socket.io.js"></script>
    <script>
      
        const socket2 = io('http://10.105.17.44:8000');
        socket2.on('connect', () => {
            console.log('Conectado al servidor emisor');
          });

        
          socket2.on('recibir-turnos-pasillo', (payload) => {
            console.log(payload)
            // Mostrar los últimos 5 elementos del arreglo
            const lastIndex = payload.length - 1;
            console.log(payload.slice(Math.max(lastIndex - 4, 0)));
        
            // Iterar sobre los últimos 5 elementos del arreglo payload
            payload.slice(Math.max(lastIndex - 4, 0)).forEach((data, index) => {
                // Obtener la fila correspondiente
                const fila = document.getElementById(`fila-${index + 1}`);
                if (fila) {
                    // Obtener los divs de números dentro de la fila
                    const divsNumeros = fila.querySelectorAll('.numeros div');
                    
                    // Iterar sobre los divs de números
                    divsNumeros.forEach((div, i) => {
                        // Verificar si hay un turno correspondiente en el arreglo data
                        if (i < data.length) {
                            const item = data[i];
                            // Asignar el folio del turno al div
                            div.textContent = item.folioTurno || '';
                            // Agregar o quitar la clase de parpadeo según el estado del turno
                            if (item.folioTurno) {
                                if (item.status === 'llamando') {
                                    div.classList.add('parpadeo');
                                } else {
                                    div.classList.remove('parpadeo');
                                }
                            } else {
                                // Si no hay turno, limpiar el contenido del div y la clase de parpadeo
                                div.textContent = '\u00A0';
                                div.classList.remove('parpadeo');
                            }
                        } else {
                            // Si no hay un turno correspondiente en el arreglo data, limpiar el contenido del div
                            div.textContent = '\u00A0';
                            div.classList.remove('parpadeo');
                        }
                    });
                }
            });
        
            // Remover el parpadeo cuando no hay turnos o el arreglo de turnos está vacío
            if (payload.every(data => data.length === 0)) {
                limpiarParpadeo();
            }
        });
        
        
        
        
        
        
        
        document.addEventListener('DOMContentLoaded', function() {
            fetch('http://10.105.17.44:8000/stands/getallstands')
                .then(response => response.json())
                .then(data => {
                    data.stands.forEach((stand, index) => {
                        const fila = document.getElementById(`fila-${index + 1}`);
                        if (fila) {
                            const celda = fila.querySelector('td:first-child');
                            if (celda) {
                                // Construir la URL completa de la imagen
                                const imageURL = `http://10.105.17.44:8000/imagenes/${stand.image}`;
                                // Establecer la imagen como fondo del td
                                celda.style.backgroundImage = `url('${imageURL}')`;
                                celda.style.backgroundSize = 'cover';
                                celda.style.backgroundPosition = 'center';
                                celda.style.backgroundRepeat = 'no-repeat';
                                // Imprimir el nombre de la imagen y el ID en la consola
                                console.log('Nombre de la imagen:', stand.image);
                                console.log('ID del objeto:', stand.id);
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error al obtener los stands:', error);
                });
        });

        // Función para limpiar el parpadeo de los números cuando no hay ticket
        function limpiarParpadeo() {
            const numerosEnPantalla = Array.from(document.querySelectorAll('.numeros div')).filter(div => div.textContent.trim() !== '');
            numerosEnPantalla.forEach(div => {
                div.classList.remove('parpadeo');
            });
        }

        function alternarPasillos() {
            var pasillo1 = document.getElementById('pasillo1');
            var pasillo2 = document.getElementById('pasillo2');
            
            // Si el pasillo1 está visible, ocúltalo y muestra el pasillo2
            if (pasillo1.style.display === 'block') {
                pasillo1.style.display = 'none';
                pasillo2.style.display = 'block';
            } else { // Si el pasillo2 está visible, ocúltalo y muestra el pasillo1
                pasillo1.style.display = 'block';
                pasillo2.style.display = 'none';
            }
        }

        // Alternar entre pasillos cada 10 segundos
        setInterval(alternarPasillos, 10000); 
    </script>
</body>

</html>