<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pasillo Turnero</title>
    <style>
        .tabla {
            border-collapse: collapse;
            width: 100%;
            margin-top: 2%;
            border-right:  1px solid black;
          
           
        }
       
     
        .tabla td {
           
            padding: 8px;
            border-left: 1px solid black;
          border-bottom:  1px solid black;
            font-size: 80px;
            font-weight: bold;
            align-items: center;
            text-align: center;
           
           
            
        }
        .tabla th{
            padding: 8px;
            border: 1px solid black;
            font-size: 80px;
            font-weight: bold;
        }
        .tabla tr {
            height: 100px;
        
        }
        .tabla img {
            max-width: 300px;
      
            max-height: 100px;
  
        }
        .tabla td:last-child {
            text-align: left;
           
          
            font-size: 130px;
            margin-right: 10%;
          
        }
        .numeros {
      display: flex;
            justify-content: space-between;
            padding: 0 10px;
            font-size: 50px;
            width: 98.8%;
            
        }
        @keyframes blink {
            0% {
                background-color: yellow;
            }
            50% {
                background-color: transparent;
            }
            100% {
                background-color: yellow;
            }
        }
        .parpadeo {
            animation: blink 1s infinite;
        }
     
        .image-container {
            text-align: right;
        }
   
        
    </style>
</head>
<body>

    <div id="pasillo1" style="display:block;">
        <div style="display: flex; align-items: center;">
            <div style="max-width: 100%; width: 100%; height: 100%;">
                <div style="height: 100%; display: flex; flex-direction: column;">
                    <div style=" justify-content: center; align-items: center; height: 100%; margin-top: 0%;">
                        <table style="width: 100%; height: 88%; font-size: 50px;" class="tabla">
                            <thead>
                                <tr>
                                    <th style="font-size: 100px; background-color: #012475; color: antiquewhite; text-align: center; "><img src="./img/expoTony.png" alt=""></th>
                                    <th style="font-size: 100px;  background-color: #012475; color: antiquewhite;    text-align: center; ">Próximos turnos   <img style="float: right;" src="./img/expoTony.png" alt=""></th>
                                </tr>
                            </thead>
                            <tbody id="tablaBody">
                                <tr id="fila-1">
                                    <td  style="background-color: rgb(198, 232, 251);"><img src="" alt="" id="imagen-1"></td>
                                    <td  class= "numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                        
                                    </td>
                                </tr>
                                <tr id="fila-2">
                                    <td><img src="" alt="" id="imagen-2"></td>
                                    <td style="align-content: center;" class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                       
                                        
                                    </td>
                                </tr>
                                <tr id="fila-3">
                                    <td  style="background-color: rgb(198, 232, 251);"><img src="" alt="" id="imagen-3"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-4">
                                    <td><img src="" alt="" id="imagen-4"></td>
                                    <td class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-5">
                                    <td  style="background-color: rgb(198, 232, 251);"><img src="" alt="" id="imagen-5"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


    </div>



    <div id="pasillo2" class="oculto">
        <div style="display: flex; align-items: center;">
            <div style="max-width: 100%; width: 100%; height: 100%;">
                <div style="height: 100%; display: flex; flex-direction: column;">
                    <div style=" justify-content: center; align-items: center; height: 100%; margin-top: 0%;">
                        <table style="width: 100%; height: 88%; font-size: 50px;" class="tabla">
                            <thead>
                                <tr>
                                    <th style="font-size: 100px; background-color: #012475; color: antiquewhite; text-align: center; "><img src="./img/expoTony.png" alt=""></th>
                                    <th style="font-size: 100px;  background-color: #012475; color: antiquewhite;    text-align: center; ">Próximos turnos   <img style="float: right;" src="./img/expoTony.png" alt=""></th>
                                </tr>
                            </thead>
                            <tbody id="tablaBody">
                                <tr id="fila-6">
                                    <td  style="background-color: rgb(198, 232, 251);"><img src="" alt="" id="imagen-6"></td>
                                    <td  class= "numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                        
                                    </td>
                                </tr>
                                <tr id="fila-7">
                                    <td><img src="" alt="" id="imagen-7"></td>
                                    <td style="align-content: center;" class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                       
                                        
                                    </td>
                                </tr>
                                <tr id="fila-8">
                                    <td  style="background-color: rgb(198, 232, 251);"><img src="" alt="" id="imagen-8"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-9">
                                    <td><img src="" alt="" id="imagen-9"></td>
                                    <td class="numeros">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                                <tr id="fila-10">
                                    <td  style="background-color: rgb(198, 232, 251);"><img src="" alt="" id="imagen-10"></td>
                                    <td class="numeros"  style="background-color: rgb(198, 232, 251);">
                                        <div id="turno-${item.standId}-${i + 1}">  </div>
                                        <div id="turno-${item.standId}-${i + 2}"> </div>
                                        <div id="turno-${item.standId}-${i + 3}"> </div>
                                        <div id="turno-${item.standId}-${i + 4}"> </div>
                                        <div id="turno-${item.standId}-${i + 5}"> </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="./socket.io/socket.io.js"></script>
    <script>
      
        const socket2 = io('http://10.105.160.37');
        socket2.on('connect', () => {
            console.log('Conectado al servidor emisor');
          });

          socket2.on('recibir-turnos-pasillo', (payload) => {
            // Limpiar todos los divs de turnos antes de procesar el nuevo payload
            const todasCeldas = document.querySelectorAll('td:last-child');
            todasCeldas.forEach(celda => celda.innerHTML = '');
        
            // Iterar sobre todas las celdas para agregar los espacios en blanco
            todasCeldas.forEach(celda => {
                for (let i = 0; i < 5; i++) {
                    const divTurno = document.createElement('div');
                    divTurno.textContent = '\u00A0'; // Carácter de espacio sin romper
                    celda.appendChild(divTurno);
                }
            });
        
            // Verificar si el payload está vacío
            if (payload.length === 0) {
                return; // Salir de la función si el payload está vacío
            }
        
            // Iterar sobre el arreglo de turnos recibidos
            payload.forEach((turnosStand, index) => {
                // Obtener el ID del stand asociado con estos turnos
                const standId = turnosStand[0]?.standId;
        
                // Buscar la imagen que corresponde al standId
                const celdaImagen = document.querySelector(`td:first-child img[data-id="${standId}"]`);
        
                // Si encontramos la imagen correspondiente
                if (celdaImagen) {
                    // Obtener el tr (fila) que contiene la imagen
                    const fila = celdaImagen.closest('tr');
        
                    // Obtener el td adyacente para los turnos en la misma fila
                    const tdTurnos = fila.querySelector('td:last-child');
        
                    // Limpiar los divs anteriores dentro del td de turnos
                    tdTurnos.innerHTML = '';
        
                    // Iterar sobre los primeros 5 divs para este stand
                    for (let i = 0; i < 5; i++) {
                        // Obtener el turno correspondiente o un espacio en blanco si no hay más turnos
                        const turno = turnosStand[i];
                        const turnoFolio = turno ? turno.folioTurno : '\u00A0'; // Carácter de espacio sin romper
                        
                        // Crear un elemento div para el turno
                        const divTurno = document.createElement('div');
                        // Agregar el turno al div o un espacio en blanco si no hay turno
                        divTurno.textContent = turnoFolio;
                        // Si el turno está definido y su status es 'llamando', agregar la clase 'parpadeo'
                        if (turno && turno.status === 'llamando') {
                            divTurno.classList.add('parpadeo');
                        }
                        tdTurnos.appendChild(divTurno);
                    }
                }
            });
        });
        
        
        
        
        
        
        
        
        
        document.addEventListener('DOMContentLoaded', function() {
            fetch('http://10.105.160.37/stands/getallstands')
                .then(response => response.json())
                .then(data => {
                    data.stands.forEach((stand, index) => {
                        const fila = document.getElementById(`fila-${index + 1}`);
                        if (fila) {
                            const celdaImagen = fila.querySelector('td:first-child img');
                            if (celdaImagen) {
                                // Guardar el ID del objeto en un atributo data-id del elemento img
                                celdaImagen.dataset.id = stand.id;
                                // Construir la URL completa de la imagen
                                const imageURL = `http://10.105.160.37/imagenes/${stand.image}`;
                                celdaImagen.src = imageURL;
                                celdaImagen.alt = '';
                                // Imprimir el nombre de la imagen y el ID en la consola
                                console.log('Nombre de la imagen:', stand.image);
                                console.log('ID del objeto:', stand.id);
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error al obtener los stands:', error);
                });
        });
        

        // Función para limpiar el parpadeo de los números cuando no hay ticket
        function limpiarParpadeo() {
            const numerosEnPantalla = Array.from(document.querySelectorAll('.numeros div')).filter(div => div.textContent.trim() !== '');
            numerosEnPantalla.forEach(div => {
                div.classList.remove('parpadeo');
            });
        }

        function alternarPasillos() {
            var pasillo1 = document.getElementById('pasillo1');
            var pasillo2 = document.getElementById('pasillo2');
            
            // Si el pasillo1 está visible, ocúltalo y muestra el pasillo2
            if (pasillo1.style.display === 'block') {
                pasillo1.style.display = 'none';
                pasillo2.style.display = 'block';
            } else { // Si el pasillo2 está visible, ocúltalo y muestra el pasillo1
                pasillo1.style.display = 'block';
                pasillo2.style.display = 'none';
            }
        }

        // Alternar entre pasillos cada 10 segundos
        setInterval(alternarPasillos, 10000); // 10000 milisegundos = 10 segundos
    </script>
</body>

</html>